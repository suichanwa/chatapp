/* Enhanced Components with Tailwind v4 */
@import "tailwindcss";

/* Make sure these styles are at the top and not overridden */
/* Modal base: hidden and non-interactive by default */
.modal {
  @apply hidden fixed inset-0 z-[10000] pointer-events-none;
}

.modal.show {
  @apply block pointer-events-auto;
}

/* Backdrop only clickable when open */
.modal .modal-overlay {
  @apply pointer-events-none;
}
.modal.show .modal-overlay {
  @apply pointer-events-auto;
}

/* Content only interactive when open */
.modal .modal-container,
.modal .modal-content {
  @apply pointer-events-none;
}
.modal.show .modal-container,
.modal.show .modal-content {
  @apply pointer-events-auto;
}

/* Overlay: only catch clicks when open */
.modal .modal-overlay {
  @apply opacity-0 pointer-events-none transition-opacity duration-200;
}

.modal.show .modal-overlay {
  @apply opacity-100 pointer-events-auto;
}

/* Content: interactive only when open */
.modal .modal-content {
  @apply opacity-0 pointer-events-none transition-all duration-200;
  transform: translateY(10px) scale(0.96);
}

.modal.show .modal-content {
  @apply opacity-100 pointer-events-auto;
  transform: translateY(0) scale(1);
  transition: transform 220ms cubic-bezier(0.2, 0.8, 0.2, 1), opacity 220ms ease;
}

/* Explicit keyframed variants used by Modal.open/close */
.modal-overlay.animate-in { 
  animation: modalOverlayIn 220ms ease both; 
}
.modal-overlay.animate-out { 
  animation: modalOverlayOut 200ms ease both; 
}
.modal-content.animate-in { 
  animation: modalContentIn 220ms cubic-bezier(0.2, 0.8, 0.2, 1) both; 
}
.modal-content.animate-out { 
  animation: modalContentOut 200ms cubic-bezier(0.2, 0.8, 0.2, 1) both; 
}

@keyframes modalOverlayIn { 
  from { opacity: 0; } 
  to { opacity: 1; } 
}
@keyframes modalOverlayOut { 
  from { opacity: 1; } 
  to { opacity: 0; } 
}
@keyframes modalContentIn { 
  from { 
    transform: translateY(12px) scale(0.96); 
    opacity: 0; 
  } 
  to { 
    transform: translateY(0) scale(1); 
    opacity: 1; 
  } 
}
@keyframes modalContentOut { 
  from { 
    transform: translateY(0) scale(1); 
    opacity: 1; 
  } 
  to { 
    transform: translateY(12px) scale(0.97); 
    opacity: 0; 
  } 
}

.modal-container {
  @apply relative flex items-center justify-center w-full h-full p-8 z-[10001];
}

.modal-content {
  @apply bg-gray-800 rounded-xl shadow-2xl w-full max-w-2xl max-h-[90vh] overflow-hidden;
  @apply transform scale-95 transition-transform duration-300 z-[10002];
  box-shadow: 0 25px 50px rgba(0, 0, 0, 0.6), 0 0 0 1px rgba(255, 255, 255, 0.05);
}

.modal.show .modal-content {
  @apply scale-100;
}

.modal-header {
  @apply flex items-center justify-between p-6 border-b border-gray-700;
  background: linear-gradient(135deg, #374151 0%, #1f2937 100%);
}

.modal-title {
  @apply text-xl font-semibold text-white m-0 flex items-center gap-3;
}

.modal-title .material-icons {
  @apply text-2xl text-blue-400;
}

.modal-close {
  @apply bg-transparent border-none text-gray-400 cursor-pointer p-2 rounded-lg;
  @apply transition-all duration-200 flex items-center justify-center w-10 h-10;
  @apply hover:bg-gray-700 hover:text-white focus:ring-2 focus:ring-gray-500;
}

.modal-close .material-icons {
  @apply text-lg;
}

.modal-body {
  @apply p-0 overflow-y-auto pointer-events-auto;
  max-height: calc(90vh - 80px);
}

/* Tab System Enhanced */
.tab-system {
  @apply flex flex-col h-full;
}

.tab-nav {
  @apply flex bg-gray-900 border-b border-gray-700;
}

.tab-button {
  @apply flex-1 flex items-center justify-center gap-2 p-4 bg-transparent border-none;
  @apply text-gray-400 cursor-pointer transition-all duration-300 font-medium relative;
  @apply hover:bg-gray-800 hover:text-gray-300 border-b-4 border-transparent text-sm;
}

.tab-button.active {
  @apply text-white bg-gray-800 border-b-blue-500;
}

.tab-icon {
  @apply text-lg;
}

.tab-content {
  @apply flex-1 relative hidden;
}

.tab-content.active {
  @apply block;
}

.tab-panel {
  @apply hidden h-full p-8;
}

.tab-panel.active {
  @apply block;
}

/* Connection Form Enhanced */
.connection-form {
  @apply max-w-lg mx-auto;
}

.form-header {
  @apply text-center mb-8;
}

.form-icon {
  @apply text-5xl mb-4 text-blue-400;
}

.form-header h4 {
  @apply text-2xl font-bold text-white m-0 mb-2;
}

.form-description {
  @apply text-gray-300 text-base m-0 leading-relaxed;
}

.form-content {
  @apply mb-8 space-y-6;
}

.form-group {
  @apply mb-6 space-y-2;
}

.form-label {
  @apply flex items-center gap-2 mb-3 font-medium text-gray-200 text-sm;
}

.label-icon {
  @apply text-base text-blue-400;
}

.input-group {
  @apply relative;
}

.form-input {
  @apply w-full py-3 px-4 border-2 border-gray-600 rounded-lg bg-gray-800 text-white text-sm;
  @apply transition-all duration-300 outline-none placeholder:text-gray-500;
  @apply focus:border-blue-500 focus:ring-2 focus:ring-blue-500/20 focus:bg-gray-750;
}

.form-input.error {
  @apply border-red-500;
  box-shadow: 0 0 0 3px rgba(239, 68, 68, 0.1);
}

.input-hint {
  @apply mt-2 text-xs text-gray-400 leading-relaxed;
}

.connection-status {
  @apply p-4 bg-gray-800 rounded-lg border border-gray-700;
}

.status-indicator {
  @apply flex items-center gap-3;
}

.status-dot {
  @apply w-3 h-3 rounded-full relative;
}

.status-dot.offline {
  @apply bg-gray-500;
}

.status-dot.connecting {
  @apply bg-yellow-500 animate-pulse;
}

.status-dot.connected,
.status-dot.online {
  @apply bg-green-500;
}

.status-dot.error {
  @apply bg-red-500;
}

.status-text {
  @apply text-sm text-gray-300 font-medium;
}

.form-actions {
  @apply text-center space-y-4;
}

/* Enhanced Buttons */
.btn {
  @apply inline-flex items-center justify-center gap-3 py-3 px-6 border-none rounded-lg;
  @apply text-sm font-semibold cursor-pointer transition-all duration-300 outline-none relative;
  @apply focus:ring-2 focus:ring-offset-2 focus:ring-offset-gray-800 overflow-hidden;
  @apply disabled:cursor-not-allowed disabled:opacity-60;
}

.btn-primary {
  @apply text-white shadow-lg transform hover:-translate-y-0.5 active:translate-y-0;
  @apply focus:ring-blue-500 disabled:transform-none disabled:shadow-none;
  background: linear-gradient(135deg, #007acc 0%, #0066aa 100%);
  box-shadow: 0 4px 15px rgba(0, 122, 204, 0.4);
}

.btn-primary:hover:not(:disabled) {
  background: linear-gradient(135deg, #0066aa 0%, #005588 100%);
  box-shadow: 0 6px 20px rgba(0, 122, 204, 0.5);
}

.btn-primary:active {
  @apply translate-y-0;
  box-shadow: 0 2px 8px rgba(0, 122, 204, 0.3);
}

.btn-secondary {
  @apply bg-gray-700 text-white border border-gray-600 shadow-md;
  @apply hover:bg-gray-600 hover:border-gray-500 hover:-translate-y-0.5;
  @apply active:translate-y-0 focus:ring-gray-500;
}

.btn-success {
  @apply text-white shadow-lg transform hover:-translate-y-0.5 active:translate-y-0;
  @apply focus:ring-green-500;
  background: linear-gradient(135deg, #28a745 0%, #218838 100%);
  box-shadow: 0 4px 15px rgba(40, 167, 69, 0.4);
}

.btn-success:hover:not(:disabled) {
  background: linear-gradient(135deg, #218838 0%, #1e7e34 100%);
  box-shadow: 0 6px 20px rgba(40, 167, 69, 0.5);
}

.btn-small {
  @apply py-2 px-3 text-xs min-w-[44px] min-h-[44px];
}

.btn-icon {
  @apply text-lg flex-shrink-0;
}

.btn-text {
  @apply flex-shrink-0 font-medium;
}

/* Loading States Enhanced */
.btn.loading {
  @apply pointer-events-none opacity-80;
}

.btn.loading .btn-icon {
  @apply animate-spin;
}

/* Copy Button States Enhanced */
.btn-secondary.success {
  @apply bg-green-500 border-green-400 text-white shadow-lg;
  box-shadow: 0 4px 15px rgba(34, 197, 94, 0.4);
}

.btn-secondary.error {
  @apply bg-red-500 border-red-400 text-white shadow-lg;
  box-shadow: 0 4px 15px rgba(239, 68, 68, 0.4);
}

/* Error Message Enhanced */
.error-message {
  @apply text-white p-4 rounded-lg mb-4 text-sm border shadow-lg;
  @apply flex items-center gap-3 border-red-400/30;
  background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
  box-shadow: 0 4px 15px rgba(220, 53, 69, 0.3);
  animation: slideIn 0.3s ease;
}

.error-message::before {
  @apply text-lg flex-shrink-0;
  content: 'warning';
  font-family: 'Material Icons';
}

/* FIXED: Privacy/Sensitive Messages - Only blur timestamps, not entire message */
.message.sensitive {
  /* Remove the blur from the entire message */
  filter: none !important;
  cursor: pointer;
  transition: all 0.3s ease;
}

.message.sensitive.revealed {
  filter: none !important;
}

/* Only blur the timestamp area when message is sensitive and not revealed */
.message.sensitive:not(.revealed) .message-time,
.message.sensitive:not(.revealed) .message-time-wrapper {
  filter: blur(4px);
  transition: filter 0.3s ease;
}

/* Remove blur when message is revealed */
.message.sensitive.revealed .message-time,
.message.sensitive.revealed .message-time-wrapper {
  filter: none;
}

/* Hover effect for sensitive messages - slightly reduce timestamp blur */
.message.sensitive:not(.revealed):hover .message-time,
.message.sensitive:not(.revealed):hover .message-time-wrapper {
  filter: blur(2px);
}

/* Privacy indicator - only show on sensitive unrevealed messages */
.message.sensitive:not(.revealed)::before {
  content: "üëÅÔ∏è Click to reveal time";
  position: absolute;
  top: 50%;
  right: 10px;
  transform: translateY(-50%);
  background: rgba(0, 0, 0, 0.8);
  color: white;
  padding: 0.25rem 0.5rem;
  border-radius: 4px;
  font-size: 0.7rem;
  pointer-events: none;
  opacity: 0;
  transition: opacity 0.2s ease;
  z-index: 10;
}

.message.sensitive:not(.revealed):hover::before {
  opacity: 1;
}

.message.sensitive.revealed::before {
  display: none;
}

/* Enhanced Animations */
@keyframes pulse {
  0%, 100% { 
    opacity: 1; 
    transform: scale(1);
  }
  50% { 
    opacity: 0.8; 
    transform: scale(1.02);
  }
}

@keyframes slideIn {
  from {
    opacity: 0;
    transform: translateY(-10px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

@keyframes spin {
  from { 
    transform: rotate(0deg); 
  }
  to { 
    transform: rotate(360deg); 
  }
}

@keyframes fadeIn {
  from { 
    opacity: 0; 
    transform: translateY(5px); 
  }
  to { 
    opacity: 1; 
    transform: translateY(0); 
  }
}

/* Responsive Design Enhanced */
@media (max-width: 768px) {
  .tab-section {
    @apply p-4;
  }
  
  .modal-tabs {
    @apply rounded-none;
  }
  
  .modal-tab,
  .tab-button {
    @apply py-3 px-4 text-xs;
  }
  
  .tab-label {
    @apply hidden;
  }
  
  .info-value {
    @apply flex-col items-start gap-2;
  }
  
  .key-container {
    @apply flex-col;
  }
  
  .address-display {
    @apply text-sm;
  }
  
  .btn {
    @apply w-full justify-center;
  }
  
  .btn-small {
    @apply w-auto min-w-[44px];
  }

  .modal-container {
    @apply p-4;
  }

  .modal-content {
    @apply max-w-full;
  }

  /* Mobile: Always show privacy indicator for sensitive messages */
  .message.sensitive:not(.revealed)::before {
    opacity: 0.7;
  }
}

@media (max-width: 480px) {
  .section-title {
    @apply text-lg;
  }
  
  .form-input {
    @apply py-3 px-3;
  }
  
  .key-display {
    @apply min-h-[100px] text-xs;
  }

  .modal-header {
    @apply p-4;
  }

  .modal-title {
    @apply text-lg;
  }
}

/* Enhanced Scrollbars with Tailwind */
.messages,
#chat-list,
.modal-body,
.tab-content,
.tab-panel,
.debug-logs,
.key-display,
.address-display,
.key-textarea,
textarea {
  scrollbar-gutter: stable both-edges;
  scrollbar-width: thin;
  scrollbar-color: transparent transparent;
}

/* Reveal scrollbar on hover */
.messages:hover,
#chat-list:hover,
.modal-body:hover,
.tab-content:hover,
.tab-panel:hover,
.debug-logs:hover,
.key-display:hover,
.address-display:hover,
.key-textarea:hover,
textarea:hover {
  scrollbar-color: rgba(255,255,255,0.3) transparent;
}

/* WebKit scrollbar styling */
.messages::-webkit-scrollbar,
#chat-list::-webkit-scrollbar,
.modal-body::-webkit-scrollbar,
.tab-content::-webkit-scrollbar,
.tab-panel::-webkit-scrollbar,
.debug-logs::-webkit-scrollbar,
.key-display::-webkit-scrollbar,
.address-display::-webkit-scrollbar,
.key-textarea::-webkit-scrollbar,
textarea::-webkit-scrollbar {
  @apply w-2 h-2;
}

.messages::-webkit-scrollbar-track,
#chat-list::-webkit-scrollbar-track,
.modal-body::-webkit-scrollbar-track,
.tab-content::-webkit-scrollbar-track,
.tab-panel::-webkit-scrollbar-track,
.debug-logs::-webkit-scrollbar-track,
.key-display::-webkit-scrollbar-track,
.address-display::-webkit-scrollbar-track,
.key-textarea::-webkit-scrollbar-track,
textarea::-webkit-scrollbar-track {
  @apply bg-transparent;
}

.messages::-webkit-scrollbar-thumb,
#chat-list::-webkit-scrollbar-thumb,
.modal-body::-webkit-scrollbar-thumb,
.tab-content::-webkit-scrollbar-thumb,
.tab-panel::-webkit-scrollbar-thumb,
.debug-logs::-webkit-scrollbar-thumb,
.key-display::-webkit-scrollbar-thumb,
.address-display::-webkit-scrollbar-thumb,
.key-textarea::-webkit-scrollbar-thumb,
textarea::-webkit-scrollbar-thumb {
  @apply bg-transparent rounded-lg;
}

/* Show scrollbar thumb on hover */
.messages:hover::-webkit-scrollbar-thumb,
#chat-list:hover::-webkit-scrollbar-thumb,
.modal-body:hover::-webkit-scrollbar-thumb,
.tab-content:hover::-webkit-scrollbar-thumb,
.tab-panel:hover::-webkit-scrollbar-thumb,
.debug-logs:hover::-webkit-scrollbar-thumb,
.key-display:hover::-webkit-scrollbar-thumb,
.address-display:hover::-webkit-scrollbar-thumb,
.key-textarea:hover::-webkit-scrollbar-thumb,
textarea:hover::-webkit-scrollbar-thumb {
  background: rgba(255,255,255,0.25);
}

/* Connection Tabs Enhanced (NewChatModal compatibility) */
.connection-tabs {
  @apply flex bg-gray-900 border-b border-gray-700 rounded-t-xl overflow-hidden;
}

.connection-tabs .tab-btn {
  @apply flex-1 flex items-center justify-center gap-2 py-4 px-6 bg-transparent border-none;
  @apply text-gray-400 cursor-pointer transition-all duration-300 font-medium relative;
  @apply hover:bg-gray-800 hover:text-gray-300 text-sm font-semibold;
}

.connection-tabs .tab-btn.active {
  @apply text-white bg-gray-800 shadow-inner;
}

.connection-tabs .tab-btn.active::after {
  @apply content-[''] absolute bottom-0 left-0 right-0 h-1;
  background: linear-gradient(135deg, #007acc 0%, #0066aa 100%);
}

/* Tab Content Toggle Enhanced */
.tab-content { 
  @apply hidden; 
}
.tab-content.active { 
  @apply block; 
}

/* Modal Z-Index Management Enhanced */
.modal-overlay {
  @apply z-[10000];
}

.modal-content,
.modal-header,
.modal-body,
.modal-tabs,
.connection-tabs,
.tab-button,
.modal-tab,
.tab-btn {
  @apply relative z-[10003] pointer-events-auto;
}

/* High Contrast Support */
@media (prefers-contrast: high) {
  .modal-content {
    @apply border-2 border-white;
  }
  
  .tab-button.active,
  .tab-btn.active {
    @apply border-2 border-blue-500;
  }
  
  .form-input:focus {
    @apply border-4;
  }
  
  .btn {
    @apply border-2 border-current;
  }

  .message.sensitive:not(.revealed) .message-time,
  .message.sensitive:not(.revealed) .message-time-wrapper {
    border: 2px solid rgba(255, 255, 255, 0.3);
  }
}

/* Reduced Motion Support */
@media (prefers-reduced-motion: reduce) {
  .btn,
  .tab-button,
  .tab-btn,
  .form-input,
  .modal-content {
    @apply transition-none;
  }
  
  .btn.loading .btn-icon {
    @apply animate-none;
  }
  
  .status-dot.connecting {
    @apply animate-none;
  }
  
  .error-message {
    animation: none;
  }
  
  .modal .modal-content,
  .modal .modal-overlay {
    @apply transition-none;
  }

  .message.sensitive:not(.revealed) .message-time,
  .message.sensitive:not(.revealed) .message-time-wrapper {
    transition: none;
  }

  .message.sensitive:not(.revealed)::before {
    transition: none;
  }
}

/* Dark Mode Enhancements */
@media (prefers-color-scheme: dark) {
  .form-input {
    @apply bg-gray-900 border-gray-500 text-gray-100;
  }
  
  .form-input:focus {
    @apply border-blue-400;
    box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.2);
  }
  
  .modal-content {
    @apply bg-gray-900;
  }
  
  .modal-header {
    background: linear-gradient(135deg, #1f2937 0%, #111827 100%);
  }
}

/* Focus States Enhanced */
.btn:focus-visible {
  @apply outline-none ring-2 ring-offset-2 ring-offset-gray-800;
}

.form-input:focus-visible {
  @apply outline-none;
}

.tab-button:focus-visible,
.tab-btn:focus-visible {
  @apply outline-none ring-2 ring-blue-500 ring-inset;
}

/* Print Styles */
@media print {
  .modal {
    @apply hidden;
  }
  
  .btn {
    @apply border border-gray-400;
  }
  
  .modal-content {
    @apply shadow-none;
  }

  /* Remove blur for print */
  .message.sensitive:not(.revealed) .message-time,
  .message.sensitive:not(.revealed) .message-time-wrapper {
    filter: none !important;
  }
}